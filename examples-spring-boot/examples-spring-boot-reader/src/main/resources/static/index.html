<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Signin Template for Bootstrap</title>
<link rel="stylesheet" href="/webjars/bootstrap/3.3.6/css/bootstrap.min.css" />
<link rel="stylesheet" href="/webjars/bootstrap/3.3.6/css/bootstrap-theme.min.css">
<script type="text/javascript" src="/webjars/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript" src="/webjars/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</head>
<body>
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="javascript:void(0);">SBReader</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li>
						<a href="/index.html">Index</a>
					</li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li>
						<a id="principal" href="javascript:void(0);"></a>
					</li>
					<li>
						<a href="/logout">Logout</a>
					</li>
				</ul>
				<form class="navbar-form navbar-right">
					<div class="form-group">
						<input type="text" class="form-control" id="input-url" placeholder="Url">
					</div>
					<button id="btn-link-save" type="button" class="btn btn-default">
						<span class="glyphicon glyphicon-plus"></span>
					</button>
				</form>
			</div>
		</div>
	</nav>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-2 sidebar">
				<div id="links" class="list-group"></div>
			</div>
			<div class="col-md-10 main">
				<table class="table table-hover table-condensed table-striped">
					<thead>
						<tr>
							<th>Title</th>
							<th>Author</th>
							<th>Created</th>
						</tr>
					</thead>
					<tbody id="items">
					</tbody>
				</table>
				<nav>
					<ul id="pager" class="pager">
					</ul>
				</nav>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		$(function() {
			function refreshLinks() {
				$.getJSON('/links?sort=title', function(model) {
					if (model && model._embedded && model._embedded.links) {
						$('#links').html('');
						$.each(model._embedded.links, function(index, link) {
							var a = $('<a></a>');
							a.attr('href', 'javascript:void(0);');
							a.addClass('list-group-item');
							a.html(link.title);
							a.click(function() {
								refreshItems();
							});
							$('#links').append(a);
						});
					}
				});
			}

			function refreshItems(url) {
				if (!url) {
					url = '/items?size=25&sort=created,desc';
				}
				$.getJSON(url, function(model) {
					if (model && model._embedded && model._embedded.items) {
						$('#items').html('');
						$.each(model._embedded.items, function(index, item) {
							var tr = $('<tr></tr>');
							tr.append($('<td></td>').append($('<a target="_blank"></a>').attr('href', item.link).html(item.title)));
							tr.append($('<td></td>').append(item.author));
							tr.append($('<td></td>').append(item.created));
							$('#items').append(tr);
						});
					}
					if (model && model._links) {
						$('#pager').html('');

						var first = $('<a></a>');
						first.attr('href', 'javascript:void(0);');
						first.html('|<');
						if (model._links.first) {
							first.click(function() {
								refreshItems(model._links.first.href);
							});
						}
						$('#pager').append($('<li></li>').append(first));

						var prev = $('<a></a>');
						prev.attr('href', 'javascript:void(0);');
						prev.html('<');
						if (model._links.prev) {
							prev.click(function() {
								refreshItems(model._links.prev.href);
							});
						}
						$('#pager').append($('<li></li>').append(prev));

						var next = $('<a></a>');
						next.attr('href', 'javascript:void(0);');
						next.html('>');
						if (model._links.next) {
							next.click(function() {
								refreshItems(model._links.next.href);
							});
						}
						$('#pager').append($('<li></li>').append(next));

						var last = $('<a></a>');
						last.attr('href', 'javascript:void(0);');
						last.html('>|');
						if (model._links.last) {
							last.click(function() {
								refreshItems(model._links.last.href);
							});
						}
						$('#pager').append($('<li></li>').append(last));
					}
				});
			}

			$.getJSON('/api/index', function(model) {
				$('#principal').html(model.principal);
			});

			refreshLinks();

			refreshItems();

			$('#btn-link-save').click(function() {
				$.ajax({
					url : '/links',
					method : 'post',
					contentType : 'application/json',
					data : JSON.stringify({
						url : $('#input-url').val()
					}),
					dataType : 'json',
					success : function(model) {
						refreshLinks();
						refreshItems();
						$('#input-url').val('');
					}
				});
			});
		});
	</script>
</body>
</html>